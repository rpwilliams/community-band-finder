<!DOCTYPE html>
<html id="main-page">
	<header>
		<title> Community Band Finder: Find a community band or orchestra near you </title>
		<link rel="icon" href="assets/images/main-screen/icons/premium/saxophonist.svg">
		<link rel="stylesheet" type="text/css" href="/css/stylesheet.css"/>
		<link rel="stylesheet" href="/assets/fonts/font-awesome-4.7.0/css/font-awesome.min.css">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	</header>

	<body>
		<!-- Loading Screen -->
		<div id="loading-screen-container">
			<div class="center">
				<video autoplay loop muted>
					<source src="/assets/videos/Stick_Figure_Musicians/violinist.mp4" type="video/mp4">
				</video>
			</div>
		</div>

		<div class="wrapper">
			<div class="logo"> 
				<h2> 
					<div class="dark-yellow">Community Band Finder</div> <div class="white" style="font-size: 15px"> Beta</div> 
				</h2> 
			</div>
			<div class="center">

				<!-- Left musician image -->
				<div class="musician-left left">
					<img src="assets/images/main-screen/icons/premium/saxophonist.svg" />
				</div>
				
				<!-- Rotating Message -->
				<div class="main-page-message">
					<h1> Find a <div class="dark-yellow"><b>community band or orchestra</b></div> near you.</h1>
				</div>
				<!-- Search Bar -->
				<div class="search-container">
					<i class="fa fa-map-marker" aria-hidden="true"></i>
					<!-- Autocomplete input with Places API -->
					<input id="autocomplete" name="location" class="search-bar" placeholder="Enter an address, neighborhood, city or ZIP code">
				</div>

				<!-- Right musician image -->
				<div class="musician-right right">
					<img src="assets/images/main-screen/icons/premium/cello.svg" />
				</div>
			</div>
			<!-- Push content to the bottom (for the footer) -->
			<div class="push"></div>
		</div>

		<!-- Google Places API -->
		<script src="https://maps.googleapis.com/maps/api/js?libraries=places&callback=autocomplete_post_req&key=AIzaSyBHZZ4-XDgacEZE7FqcDRcmJzRBtSaEBMg" async defer></script>

		<script>
			/* 
				Places API autocomplete functions.
				Based on https://developers.google.com/maps/documentation/javascript/examples/places-autocomplete-addressform
			 */
			 var autocomplete;

			 function initAutocomplete() {
			 	// Create the autocomplete object, restricting the search to
			 	// geographical location types
			 	autocomplete = new google.maps.places.Autocomplete(
			 		/** @type {!HTMLInputElement} */(document.getElementById('autocomplete')),
			 		{types: ['geocode']});
			 }

			 function autocomplete_post_req() {
			 	initAutocomplete();

		 		// When the user selects an address from the dropdown
		 		autocomplete.addListener('place_changed', function() {
		 			var place = autocomplete.getPlace();

		 			console.log(place);

					var lat = place.geometry.location.lat();
					var lng = place.geometry.location.lng();
					var radius = 75; // TODO: make this dynamic
					var coords = "@" + lat + "," + lng;
					var searchUrl = '/search/' + radius + '/' + coords;

					// Show the loading screen
					$('#loading-screen-container').show();

					$.ajax({
						type: 'POST',
						url: searchUrl,
						data: {lat: lat, lng: lng},
						success: function() {
							// handle response here
							console.log('Success!');
							window.location.href = searchUrl;
						},
						error: function(err) {
							console.log(err);
							console.log('Failure :(');
						}
					});
		 		});
			}

			// Bias the autocomplete object to the user's geographical location,
			// as supplied by the browser's 'navigator.geolocation' object.
			document.body.onload = function() {
				if(navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(function(position) {
						var geolocation = {
							lat: position.coords.latitude,
							lng: position.coords.longitude
						};
						var circle = new google.maps.Circle({
							center: geolocation,
							radius: position.coords.accuracy
						});
						autocomplete.setBounds(circle.getBounds());
					});
				}
			}
		</script>

		<!-- Footer -->
		<footer class="footer-distributed">

			<div class="footer-right">
				<a href="https://www.linkedin.com/in/rpwilliams96/"><i class="fa fa-linkedin"></i></a>

				<a href="https://www.github.com/rpwilliams"><i class="fa fa-github"></i></a>
			</div>

			<div class="footer-left">
				<p>&copy; 2018 Ryan Williams. All rights reserved.</p>
				<p>Developed by <a class="footer-links" href='http://www.RyanPaulWilliams.com' style="color: #FC3; text-decoration: underline;">Ryan Williams.</a></p>
			</div>
		</footer>
	</body>
</html>
